import { runScenario } from "@/lib/courses/solana-security/project/exploit/run";
import type { ScenarioSpec } from "@/lib/courses/solana-security/project/types";

export interface ScenarioDiff {
  id: string;
  vulnerableOk: boolean;
  fixedOk: boolean;
  vulnerableCode?: string;
  fixedCode?: string;
  recipientDeltaVulnerable: string;
  recipientDeltaFixed: string;
}

export function compareScenarioModes(scenario: ScenarioSpec): ScenarioDiff {
  const vulnerable = runScenario("vulnerable", scenario);
  const fixed = runScenario("fixed", scenario);

  const vulnerableDelta = (BigInt(vulnerable.afterRecipientLamports) - BigInt(vulnerable.beforeRecipientLamports)).toString();
  const fixedDelta = (BigInt(fixed.afterRecipientLamports) - BigInt(fixed.beforeRecipientLamports)).toString();

  return {
    id: scenario.id,
    vulnerableOk: vulnerable.ok,
    fixedOk: fixed.ok,
    vulnerableCode: vulnerable.code,
    fixedCode: fixed.code,
    recipientDeltaVulnerable: vulnerableDelta,
    recipientDeltaFixed: fixedDelta,
  };
}
