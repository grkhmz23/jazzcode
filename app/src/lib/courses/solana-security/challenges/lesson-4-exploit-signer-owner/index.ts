import type { TestCase } from "@/types/content";

export const lesson4StarterCode = `function run(input) {
  return JSON.stringify(buildSignerOwnerExploitProof(input));
}

function buildSignerOwnerExploitProof(input) {
  // Return deterministic evidence for signer+owner exploit scenario.
  return {
    scenario: "signer-owner",
    beforeVaultBalance: "0",
    afterVaultBalance: "0",
    beforeRecipientLamports: "0",
    afterRecipientLamports: "0",
    traceHash: "",
    explanation: "",
  };
}
`;

export const lesson4SolutionCode = `function run(input) {
  return JSON.stringify(buildSignerOwnerExploitProof(input));
}

function buildSignerOwnerExploitProof(input) {
  const drained = BigInt(input.afterRecipientLamports) - BigInt(input.beforeRecipientLamports);
  return {
    scenario: "signer-owner",
    beforeVaultBalance: input.beforeVaultBalance,
    afterVaultBalance: input.afterVaultBalance,
    beforeRecipientLamports: input.beforeRecipientLamports,
    afterRecipientLamports: input.afterRecipientLamports,
    traceHash: input.traceHash,
    explanation: "Exploit succeeded in vulnerable mode because signer/owner validation was missing. drained=" + drained.toString(),
  };
}
`;

export const lesson4Hints: string[] = [
  "Compute drained lamports from recipient before/after.",
  "Include deterministic field ordering in the JSON output.",
  "The explanation should mention missing signer/owner validation.",
];

export const lesson4TestCases: TestCase[] = [
  {
    name: "builds signer-owner exploit proof",
    input: JSON.stringify({
      beforeVaultBalance: "1000",
      afterVaultBalance: "300",
      beforeRecipientLamports: "10",
      afterRecipientLamports: "710",
      traceHash: "abc123",
    }),
    expectedOutput:
      '{"scenario":"signer-owner","beforeVaultBalance":"1000","afterVaultBalance":"300","beforeRecipientLamports":"10","afterRecipientLamports":"710","traceHash":"abc123","explanation":"Exploit succeeded in vulnerable mode because signer/owner validation was missing. drained=700"}',
  },
  {
    name: "supports zero-drain evidence case",
    input: JSON.stringify({
      beforeVaultBalance: "500",
      afterVaultBalance: "500",
      beforeRecipientLamports: "20",
      afterRecipientLamports: "20",
      traceHash: "zero001",
    }),
    expectedOutput:
      '{"scenario":"signer-owner","beforeVaultBalance":"500","afterVaultBalance":"500","beforeRecipientLamports":"20","afterRecipientLamports":"20","traceHash":"zero001","explanation":"Exploit succeeded in vulnerable mode because signer/owner validation was missing. drained=0"}',
  },
];
