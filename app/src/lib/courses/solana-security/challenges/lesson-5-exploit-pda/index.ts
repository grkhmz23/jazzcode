import type { TestCase } from "@/types/content";

export const lesson5StarterCode = `function run(input) {
  return JSON.stringify(buildPdaSpoofProof(input));
}

function buildPdaSpoofProof(input) {
  return {
    scenario: "pda-spoof",
    expectedPda: input.expectedPda,
    acceptedPda: input.acceptedPda,
    mismatch: false,
    traceHash: "",
  };
}
`;

export const lesson5SolutionCode = `function run(input) {
  return JSON.stringify(buildPdaSpoofProof(input));
}

function buildPdaSpoofProof(input) {
  const mismatch = input.expectedPda !== input.acceptedPda;
  return {
    scenario: "pda-spoof",
    expectedPda: input.expectedPda,
    acceptedPda: input.acceptedPda,
    mismatch,
    traceHash: input.traceHash,
  };
}
`;

export const lesson5Hints: string[] = [
  "Return whether expectedPda and acceptedPda differ.",
  "Use strict boolean output for mismatch.",
  "Keep output key order stable.",
];

export const lesson5TestCases: TestCase[] = [
  {
    name: "detects pda mismatch",
    input: JSON.stringify({
      expectedPda: "PDA_expected",
      acceptedPda: "PDA_spoofed",
      traceHash: "def456",
    }),
    expectedOutput:
      '{"scenario":"pda-spoof","expectedPda":"PDA_expected","acceptedPda":"PDA_spoofed","mismatch":true,"traceHash":"def456"}',
  },
  {
    name: "no mismatch when accepted pda matches expected pda",
    input: JSON.stringify({
      expectedPda: "PDA_expected",
      acceptedPda: "PDA_expected",
      traceHash: "abc123",
    }),
    expectedOutput:
      '{"scenario":"pda-spoof","expectedPda":"PDA_expected","acceptedPda":"PDA_expected","mismatch":false,"traceHash":"abc123"}',
  },
  {
    name: "handles empty PDA inputs deterministically",
    input: JSON.stringify({
      expectedPda: "",
      acceptedPda: "",
      traceHash: "empty000",
    }),
    expectedOutput:
      '{"scenario":"pda-spoof","expectedPda":"","acceptedPda":"","mismatch":false,"traceHash":"empty000"}',
  },
];
