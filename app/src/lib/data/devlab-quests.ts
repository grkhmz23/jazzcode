import { Quest } from "@/lib/devlab/types";

const foundationTrack: Quest = {
  id: "foundation-track",
  track: "foundation",
  title: "Terminal & Solana Basics",
  description: "Learn terminal navigation and Solana core concepts before building.",
  missions: [
    {
      id: "foundation-1",
      title: "Navigate the Terminal",
      difficulty: "easy",
      description: "Learn basic filesystem navigation commands: pwd, ls, cd, and mkdir.",
      xpReward: 25,
      objectives: [
        { id: "f1-o1", text: "Run pwd to see current directory", type: "command", validation: { type: "command_match", pattern: "^pwd$" }, completed: false },
        { id: "f1-o2", text: "Run ls to list files", type: "command", validation: { type: "command_match", pattern: "^ls$" }, completed: false },
        { id: "f1-o3", text: "Run ls -la for detailed listing", type: "command", validation: { type: "command_match", pattern: "^ls\s+-la$" }, completed: false },
        { id: "f1-o4", text: "Run mkdir my-folder to create a directory", type: "command", validation: { type: "command_match", pattern: "^mkdir\s+my-folder$" }, completed: false },
        { id: "f1-o5", text: "Run cd my-folder to enter the directory", type: "command", validation: { type: "command_match", pattern: "^cd\s+my-folder$" }, completed: false },
      ],
      hints: ["pwd = print working directory", "ls lists files, -la shows hidden files", "mkdir creates folders, cd changes into them"],
      successMessage: "Navigation mastered!",
    },
    {
      id: "foundation-2",
      title: "File Operations",
      difficulty: "easy",
      description: "Create, view, and manage files with cat, touch, echo, and rm.",
      xpReward: 30,
      objectives: [
        { id: "f2-o1", text: "Run touch hello.txt to create a file", type: "command", validation: { type: "command_match", pattern: "^touch\s+hello\\.txt$" }, completed: false },
        { id: "f2-o2", text: "Run echo 'Hello Solana' > hello.txt to write content", type: "command", validation: { type: "command_match", pattern: "^echo\s+['\"]Hello Solana['\"]\s+>\s+hello\\.txt$" }, completed: false },
        { id: "f2-o3", text: "Run cat hello.txt to view contents", type: "command", validation: { type: "command_match", pattern: "^cat\s+hello\\.txt$" }, completed: false },
        { id: "f2-o4", text: "Run rm hello.txt to delete the file", type: "command", validation: { type: "command_match", pattern: "^rm\s+hello\\.txt$" }, completed: false },
      ],
      hints: ["touch creates empty files", "echo with > writes to files", "cat displays file contents", "rm deletes files permanently"],
      chaosVariants: [
        {
          trigger: "rm\s+-rf\s+/",
          condition: "always",
          errorOutput: "Error: Permission denied. This would delete system files!",
          hint: "Never run rm -rf / or rm -rf ~",
        },
      ],
      successMessage: "File operations mastered!",
    },
    {
      id: "foundation-3",
      title: "Understanding Paths",
      difficulty: "easy",
      description: "Learn absolute vs relative paths and navigation shortcuts.",
      xpReward: 35,
      objectives: [
        { id: "f3-o1", text: "Run cd .. to go up one directory", type: "command", validation: { type: "command_match", pattern: "^cd\s+\\.\\.$" }, completed: false },
        { id: "f3-o2", text: "Run cd ~ to go to home directory", type: "command", validation: { type: "command_match", pattern: "^cd\s+~$" }, completed: false },
        { id: "f3-o3", text: "Run cd - to go to previous directory", type: "command", validation: { type: "command_match", pattern: "^cd\s+-$" }, completed: false },
        { id: "f3-o4", text: "Run pwd to confirm your location", type: "command", validation: { type: "command_match", pattern: "^pwd$" }, completed: false },
      ],
      hints: [".. means parent directory", "~ is your home folder", "- toggles between last two directories", "pwd shows full absolute path"],
      successMessage: "Path navigation mastered!",
    },
    {
      id: "foundation-4",
      title: "What is Solana?",
      difficulty: "easy",
      description: "Understand Solana's account model, programs, and state storage.",
      xpReward: 40,
      objectives: [
        { id: "f4-o1", text: "Run solana --help to see available commands", type: "command", validation: { type: "command_match", pattern: "^solana\s+--help$" }, completed: false },
        { id: "f4-o2", text: "Run solana config get to view current config", type: "command", validation: { type: "command_match", pattern: "^solana\s+config\s+get$" }, completed: false },
        { id: "f4-o3", text: "Read about accounts: Run cat ~/solana-basics.md", type: "command", validation: { type: "command_match", pattern: "^cat\s+~/solana-basics\\.md$" }, completed: false },
      ],
      hints: ["Solana has accounts, not contracts", "Programs are stateless logic", "Data lives in accounts", "Read the basics file to learn more"],
      requiredFiles: {
        "solana-basics.md": "# Solana Basics\n\n## Accounts\nEverything on Solana is an account. Accounts store:\n- Lamports (SOL balance)\n- Data (program state)\n- Owner (the program that can modify it)\n\n## Programs\n- Programs are executable code\n- They are stateless (no internal storage)\n- They operate on accounts passed to them\n\n## Key Concepts\n- Rent: Accounts need minimum SOL to exist\n- Rent-exemption: Deposit enough SOL to never pay rent\n- PDAs: Program-derived addresses for deterministic state\n",
      },
      successMessage: "Solana fundamentals understood!",
    },
    {
      id: "foundation-5",
      title: "Rent and Lamports",
      difficulty: "medium",
      description: "Learn about account costs, rent exemption, and lamports (smallest SOL unit).",
      xpReward: 50,
      objectives: [
        { id: "f5-o1", text: "Run cat ~/rent-explanation.md to read about rent", type: "command", validation: { type: "command_match", pattern: "^cat\s+~/rent-explanation\\.md$" }, completed: false },
        { id: "f5-o2", text: "Run solana airdrop 1 to get test SOL", type: "command", validation: { type: "command_match", pattern: "^solana\s+airdrop\s+1$" }, completed: false },
        { id: "f5-o3", text: "Run solana balance to check your lamports", type: "command", validation: { type: "command_match", pattern: "^solana\s+balance$" }, completed: false },
        { id: "f5-o4", text: "Run solana rent 100 to calculate rent for 100 bytes", type: "command", validation: { type: "command_match", pattern: "^solana\s+rent\s+100$" }, completed: false },
      ],
      hints: ["1 SOL = 1,000,000,000 lamports", "Accounts need rent to exist", "Rent-exempt accounts never pay ongoing rent", "Use solana rent <bytes> to calculate costs"],
      requiredFiles: {
        "rent-explanation.md": "# Rent on Solana\n\n## Lamports\n- Smallest unit of SOL (like cents to dollars)\n- 1 SOL = 1,000,000,000 lamports\n- All operations cost lamports\n\n## Rent\n- Accounts pay rent based on data size\n- Two states: Rent-paying or Rent-exempt\n\n## Rent-Exemption\n- Deposit enough SOL to cover 2 years of rent\n- Account becomes rent-exempt\n- No ongoing rent charges\n\n## Why It Matters\n- Creating accounts costs SOL\n- Bigger accounts = more SOL needed\n- Always aim for rent-exemption\n",
      },
      successMessage: "Rent and lamports understood!",
    },
  ],
};

const builderTrack: Quest = {
  id: "builder-track",
  track: "builder",
  title: "From Zero to Deploy",
  description: "Build, test, and deploy your first Anchor program on devnet.",
  missions: [
    {
      id: "builder-1",
      title: "Verify Your Environment",
      difficulty: "easy",
      description: "Confirm the toolchain versions used in Solana development.",
      xpReward: 50,
      objectives: [
        { id: "b1-o1", text: "Run rustc --version", type: "command", validation: { type: "command_match", pattern: "^rustc\\s+--version$" }, completed: false },
        { id: "b1-o2", text: "Run cargo --version", type: "command", validation: { type: "command_match", pattern: "^cargo\\s+--version$" }, completed: false },
        { id: "b1-o3", text: "Run solana --version", type: "command", validation: { type: "command_match", pattern: "^solana\\s+--version$" }, completed: false },
        { id: "b1-o4", text: "Run anchor --version", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+--version$" }, completed: false },
      ],
      hints: ["Type each version command exactly", "These commands validate your environment", "Try: rustc --version"],
      successMessage: "Toolchain verified.",
    },
    {
      id: "builder-2",
      title: "Configure for Devnet",
      difficulty: "easy",
      description: "Set Solana CLI to the devnet cluster and confirm settings.",
      xpReward: 75,
      objectives: [
        { id: "b2-o1", text: "Run solana config set --url devnet", type: "command", validation: { type: "command_match", pattern: "^solana\\s+config\\s+set\\s+--url\\s+devnet$" }, completed: false },
        { id: "b2-o2", text: "Run solana config get", type: "command", validation: { type: "command_match", pattern: "^solana\\s+config\\s+get$" }, completed: false },
      ],
      hints: ["Devnet is the test network", "Use config set then config get", "Command: solana config set --url devnet"],
      chaosVariants: [
        {
          trigger: "config\\s+set\\s+--url\\s+mainnet",
          condition: "always",
          errorOutput: "Warning: You are connecting to mainnet-beta. Transactions will use real SOL!",
          hint: "Use devnet for development",
        },
      ],
      successMessage: "Devnet configured.",
    },
    {
      id: "builder-3",
      title: "Create Your Identity",
      difficulty: "easy",
      description: "Generate a keypair, check address, then request an airdrop.",
      xpReward: 100,
      objectives: [
        { id: "b3-o1", text: "Run solana-keygen new --outfile ~/.config/solana/id.json", type: "command", validation: { type: "command_match", pattern: "^solana-keygen\\s+new\\s+--outfile\\s+~/.config/solana/id.json$" }, completed: false },
        { id: "b3-o2", text: "Run solana address", type: "command", validation: { type: "command_match", pattern: "^solana\\s+address$" }, completed: false },
        { id: "b3-o3", text: "Run solana airdrop 2", type: "command", validation: { type: "command_match", pattern: "^solana\\s+airdrop\\s+2$" }, completed: false },
        { id: "b3-o4", text: "Run solana balance", type: "command", validation: { type: "command_match", pattern: "^solana\\s+balance$" }, completed: false },
      ],
      hints: ["Create your keypair first", "Airdrop max per request is 5 SOL", "Use: solana airdrop 2"],
      chaosVariants: [
        {
          trigger: "airdrop\\s+10",
          condition: "always",
          errorOutput: "Error: airdrop request failed. This can happen when the rate limit is reached.",
          hint: "Max 5 SOL per request on devnet",
        },
      ],
      successMessage: "Identity ready.",
    },
    {
      id: "builder-4",
      title: "Your First Transfer",
      difficulty: "easy",
      description: "Send SOL to another address and confirm the transaction.",
      xpReward: 100,
      objectives: [
        { id: "b4-o1", text: "Run solana transfer GrAkKfEpTKQuHh9p7zM8nq9w7M4f6GQ9x3W5j8dL2fV 0.5", type: "command", validation: { type: "command_match", pattern: "^solana\\s+transfer\\s+GrAkKfEpTKQuHh9p7zM8nq9w7M4f6GQ9x3W5j8dL2fV\\s+0.5$" }, completed: false },
        { id: "b4-o2", text: "Run solana balance", type: "command", validation: { type: "command_match", pattern: "^solana\\s+balance$" }, completed: false },
        { id: "b4-o3", text: "Run solana confirm <signature>", type: "command", validation: { type: "command_match", pattern: "^solana\\s+confirm\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Transfer deducts amount + fee", "Use signature output from transfer", "Check balance before and after"],
      chaosVariants: [
        {
          trigger: "transfer.*100",
          condition: "balance < 100",
          errorOutput: "Error: Dynamic program error: InsufficientFunds",
          hint: "Check your balance first with solana balance",
        },
      ],
      successMessage: "Transfer confirmed.",
    },
    {
      id: "builder-5",
      title: "Initialize Anchor Project",
      difficulty: "medium",
      description: "Scaffold an Anchor project and inspect generated config/code.",
      xpReward: 150,
      objectives: [
        { id: "b5-o1", text: "Run anchor init my_program", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+init\\s+my_program$" }, completed: false },
        { id: "b5-o2", text: "Run cat Anchor.toml", type: "command", validation: { type: "command_match", pattern: "^cat\\s+Anchor.toml$" }, completed: false },
        { id: "b5-o3", text: "Run cat programs/my_program/src/lib.rs", type: "command", validation: { type: "command_match", pattern: "^cat\\s+programs/my_program/src/lib.rs$" }, completed: false },
      ],
      hints: ["Anchor init bootstraps your project", "Read config to understand cluster and wallet", "Inspect lib.rs entrypoint"],
      successMessage: "Anchor project initialized.",
    },
    {
      id: "builder-6",
      title: "Understand the Code",
      difficulty: "medium",
      description: "Open core files in the editor to understand project structure.",
      xpReward: 100,
      objectives: [
        { id: "b6-o1", text: "Open programs/my_program/src/lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: ".+" }, completed: false },
        { id: "b6-o2", text: "Open Anchor.toml", type: "edit", validation: { type: "file_contains", path: "my-solana-project/Anchor.toml", pattern: ".+" }, completed: false },
        { id: "b6-o3", text: "Open tests/my_program.ts", type: "edit", validation: { type: "file_contains", path: "my-solana-project/tests/my_program.ts", pattern: ".+" }, completed: false },
      ],
      hints: ["Use file explorer clicks", "You only need to open files", "Check open tabs"],
      successMessage: "Project structure understood.",
    },
    {
      id: "builder-7",
      title: "Build Your Program",
      difficulty: "medium",
      description: "Compile your Anchor program and inspect build artifacts.",
      xpReward: 150,
      objectives: [
        { id: "b7-o1", text: "Run anchor build", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+build$" }, completed: false },
        { id: "b7-o2", text: "Run ls target/deploy/", type: "command", validation: { type: "command_match", pattern: "^ls\\s+target/deploy/?$" }, completed: false },
        { id: "b7-o3", text: "Run ls target/idl/", type: "command", validation: { type: "command_match", pattern: "^ls\\s+target/idl/?$" }, completed: false },
      ],
      hints: ["Build generates .so and IDL", "Inspect target folders with ls", "Fix syntax issues in lib.rs if needed"],
      chaosVariants: [
        {
          trigger: "anchor\\s+build",
          condition: "lib.rs has syntax error",
          errorOutput: "error[E0432]: unresolved import...",
          hint: "Check your lib.rs for syntax errors",
        },
      ],
      successMessage: "Build artifacts created.",
    },
    {
      id: "builder-8",
      title: "Write and Run Tests",
      difficulty: "medium",
      description: "Add a test assertion and run the Anchor test suite.",
      xpReward: 200,
      objectives: [
        { id: "b8-o1", text: "Edit tests/my_program.ts to include assert/expect", type: "edit", validation: { type: "file_contains", path: "my-solana-project/tests/my_program.ts", pattern: "assert|expect" }, completed: false },
        { id: "b8-o2", text: "Run anchor test", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+test$" }, completed: false },
      ],
      hints: ["Use chai expect/assert", "Save the file before running tests", "Then run anchor test"],
      chaosVariants: [
        {
          trigger: "anchor\\s+test",
          condition: "test has wrong assertion",
          errorOutput: "AssertionError: expected...",
          hint: "Check expected values in your assertion",
        },
      ],
      successMessage: "Tests passed.",
    },
    {
      id: "builder-9",
      title: "Deploy to Devnet",
      difficulty: "hard",
      description: "Ensure funds are available and deploy your program.",
      xpReward: 250,
      objectives: [
        { id: "b9-o1", text: "Run solana balance", type: "state_check", validation: { type: "state_predicate", check: "balance > 2" }, completed: false },
        { id: "b9-o2", text: "Run anchor deploy", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+deploy$" }, completed: false },
        { id: "b9-o3", text: "Run solana program show <programId>", type: "command", validation: { type: "command_match", pattern: "^solana\\s+program\\s+show\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Deploy needs enough SOL", "Top up with airdrop if needed", "Use program id from deploy output"],
      chaosVariants: [
        {
          trigger: "anchor\\s+deploy",
          condition: "balance < 2",
          errorOutput: "Error: Account ... has insufficient funds for spend",
          hint: "You need at least 2 SOL. Try: solana airdrop 2",
        },
      ],
      successMessage: "Program deployed.",
    },
    {
      id: "builder-10",
      title: "Full Stack Verification",
      difficulty: "hard",
      description: "Initialize IDL on-chain and verify your deployed program.",
      xpReward: 300,
      objectives: [
        { id: "b10-o1", text: "Run anchor idl init <programId> --filepath target/idl/my_program.json", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+idl\\s+init\\s+[1-9A-HJ-NP-Za-km-z]{20,}\\s+--filepath\\s+target/idl/my_program.json$" }, completed: false },
        { id: "b10-o2", text: "Run solana program show <programId>", type: "command", validation: { type: "command_match", pattern: "^solana\\s+program\\s+show\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
        { id: "b10-o3", text: "Run anchor verify <programId>", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+verify\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Use the same deployed program id", "IDL path should exist in target/idl", "anchor verify checks deterministic build"],
      successMessage: "Congratulations! You deployed your first Solana program!",
    },
    {
      id: "builder-11",
      title: "Understanding Anchor.toml",
      difficulty: "medium",
      description: "Deep dive into Anchor configuration and workspace settings.",
      xpReward: 120,
      objectives: [
        { id: "b11-o1", text: "Open and read Anchor.toml", type: "edit", validation: { type: "file_contains", path: "my-solana-project/Anchor.toml", pattern: "\." }, completed: false },
        { id: "b11-o2", text: "View features section in Anchor.toml", type: "command", validation: { type: "command_match", pattern: "^cat\s+Anchor.toml\\s*\\|\\s*grep\s+features" }, completed: false },
        { id: "b11-o3", text: "Check programs section in Anchor.toml", type: "command", validation: { type: "command_match", pattern: "^cat\s+Anchor.toml\\s*\\|\\s*grep\s+-A2\\s+\\[programs" }, completed: false },
      ],
      hints: ["Anchor.toml configures cluster, wallet, and features", "Programs section maps names to IDs", "Features enable Anchor functionality"],
      requiredFiles: {
        "anchor-toml-guide.md": "# Anchor.toml Guide\n\n## [features]\n- seeds: Enable PDAs with seeds\n- cpi: Enable Cross-Program Invocation\n\n## [programs]\n- localnet/devnet/mainnet mappings\n- Program IDs per cluster\n\n## [provider]\n- cluster: Target network\n- wallet: Keypair for transactions\n",
      },
      successMessage: "Anchor.toml mastered!",
    },
    {
      id: "builder-12",
      title: "Understanding lib.rs Structure",
      difficulty: "medium",
      description: "Learn the anatomy of an Anchor program's main file.",
      xpReward: 140,
      objectives: [
        { id: "b12-o1", text: "Find declare_id! macro in lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "declare_id!" }, completed: false },
        { id: "b12-o2", text: "View #[program] module structure", type: "command", validation: { type: "command_match", pattern: "^cat\s+programs/my_program/src/lib.rs\\s*\\|\\s*grep\s+-A5\\s+#\\[program\\]" }, completed: false },
        { id: "b12-o3", text: "Identify instruction handlers in lib.rs", type: "command", validation: { type: "command_match", pattern: "^cat\s+programs/my_program/src/lib.rs\\s*\\|\\s*grep\s+pub\\s+fn" }, completed: false },
      ],
      hints: ["declare_id! sets the program address", "#[program] contains instruction handlers", "Each pub fn is a callable instruction"],
      successMessage: "lib.rs structure understood!",
    },
    {
      id: "builder-13",
      title: "Your First Account Structure",
      difficulty: "medium",
      description: "Learn to define and use account structures with #[derive(Accounts)].",
      xpReward: 160,
      objectives: [
        { id: "b13-o1", text: "Find #[derive(Accounts)] in lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "#\\[derive\\(Accounts\\)\\]" }, completed: false },
        { id: "b13-o2", text: "View Context usage in instruction", type: "command", validation: { type: "command_match", pattern: "^cat\s+programs/my_program/src/lib.rs\\s*\\|\\s*grep\s+Context" }, completed: false },
        { id: "b13-o3", text: "Run anchor build to verify structure", type: "command", validation: { type: "command_match", pattern: "^anchor\s+build$" }, completed: false },
      ],
      hints: ["#[derive(Accounts)] defines validation", "Context<T> provides access to accounts", "Build checks your structure is valid"],
      chaosVariants: [
        {
          trigger: "anchor\\s+build",
          condition: "missing derive",
          errorOutput: "error: cannot find derive macro `Accounts`",
          hint: "Make sure to include use anchor_lang::prelude::*",
        },
      ],
      successMessage: "Account structure understood!",
    },
    {
      id: "builder-14",
      title: "Error Handling",
      difficulty: "medium",
      description: "Add custom error codes and handle failures gracefully.",
      xpReward: 150,
      objectives: [
        { id: "b14-o1", text: "Find #[error_code] in lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "#\\[error_code\\]" }, completed: false },
        { id: "b14-o2", text: "Add require! macro usage to lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "require!" }, completed: false },
        { id: "b14-o3", text: "Run anchor test to verify error handling", type: "command", validation: { type: "command_match", pattern: "^anchor\s+test$" }, completed: false },
      ],
      hints: ["#[error_code] defines custom errors", "require! checks conditions and throws errors", "Test that errors trigger correctly"],
      successMessage: "Error handling mastered!",
    },
    {
      id: "builder-15",
      title: "Events and Logging",
      difficulty: "hard",
      description: "Use events and logging for debugging and monitoring.",
      xpReward: 180,
      objectives: [
        { id: "b15-o1", text: "Add #[event] struct to lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "#\\[event\\]" }, completed: false },
        { id: "b15-o2", text: "Use emit! macro in an instruction", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "emit!" }, completed: false },
        { id: "b15-o3", text: "Add msg! macro for logging", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "msg!" }, completed: false },
        { id: "b15-o4", text: "Run anchor test to verify events emit", type: "command", validation: { type: "command_match", pattern: "^anchor\s+test$" }, completed: false },
      ],
      hints: ["#[event] defines indexable events", "emit! triggers events for clients", "msg! logs to program logs for debugging"],
      successMessage: "Events and logging mastered!",
    },
  ],
};

const tokenTrack: Quest = {
  id: "token-track",
  track: "token",
  title: "Token Mastery",
  description: "Create, mint, transfer, and manage SPL tokens.",
  missions: [
    {
      id: "token-1",
      title: "Create a Fungible Token",
      difficulty: "easy",
      description: "Create your first SPL token and verify supply starts at zero.",
      xpReward: 75,
      objectives: [
        { id: "t1-o1", text: "Run spl-token create-token", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+create-token$" }, completed: false },
        { id: "t1-o2", text: "Run spl-token supply <mint>", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+supply\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Create token first", "Supply should be 0 initially", "Use returned mint address"],
      successMessage: "Token created.",
    },
    {
      id: "token-2",
      title: "Create Token Account",
      difficulty: "easy",
      description: "Create an account to hold your new token.",
      xpReward: 75,
      objectives: [
        { id: "t2-o1", text: "Run spl-token create-account <mint>", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+create-account\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Use the mint address from mission 1", "Token accounts are required to hold balances", "Run create-account with mint"],
      successMessage: "Token account created.",
    },
    {
      id: "token-3",
      title: "Mint Your First Tokens",
      difficulty: "easy",
      description: "Mint tokens and validate account balance and total supply.",
      xpReward: 100,
      objectives: [
        { id: "t3-o1", text: "Run spl-token mint <mint> 1000", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+mint\\s+[1-9A-HJ-NP-Za-km-z]{20,}\\s+1000$" }, completed: false },
        { id: "t3-o2", text: "Run spl-token balance <mint>", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+balance\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
        { id: "t3-o3", text: "Run spl-token supply <mint>", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+supply\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Mint increases supply", "Balance and supply should reflect minted amount", "Keep using same mint"],
      successMessage: "Tokens minted.",
    },
    {
      id: "token-4",
      title: "Transfer Tokens",
      difficulty: "medium",
      description: "Send tokens to another account and validate the resulting balance.",
      xpReward: 125,
      objectives: [
        { id: "t4-o1", text: "Run spl-token transfer <mint> 100 <recipient> --fund-recipient", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+transfer\\s+[1-9A-HJ-NP-Za-km-z]{20,}\\s+100\\s+[1-9A-HJ-NP-Za-km-z]{20,}(\\s+--fund-recipient)?$" }, completed: false },
        { id: "t4-o2", text: "Run spl-token balance <mint>", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+balance\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Recipient can be a token account address", "Transfer reduces sender balance", "Use --fund-recipient when needed"],
      chaosVariants: [{ trigger: "spl-token\\s+transfer", condition: "token balance < amount", errorOutput: "Error: insufficient token balance", hint: "Mint more first" }],
      successMessage: "Tokens transferred.",
    },
    {
      id: "token-5",
      title: "Token with Custom Decimals",
      difficulty: "medium",
      description: "Create a token with 6 decimals and understand precision.",
      xpReward: 125,
      objectives: [
        { id: "t5-o1", text: "Run spl-token create-token --decimals 6", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+create-token\\s+--decimals\\s+6$" }, completed: false },
      ],
      hints: ["Decimals control smallest unit", "6 is common for stable assets", "Use --decimals 6"],
      successMessage: "Custom decimal token created.",
    },
    {
      id: "token-6",
      title: "Manage Token Authority",
      difficulty: "medium",
      description: "Change and revoke token authorities.",
      xpReward: 150,
      objectives: [
        { id: "t6-o1", text: "Run spl-token authorize <mint> mint --new-authority <new>", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+authorize\\s+[1-9A-HJ-NP-Za-km-z]{20,}\\s+mint\\s+--new-authority\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
        { id: "t6-o2", text: "Run spl-token authorize <mint> freeze --disable", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+authorize\\s+[1-9A-HJ-NP-Za-km-z]{20,}\\s+freeze\\s+--disable$" }, completed: false },
      ],
      hints: ["Authority controls mint/freeze actions", "Use new authority for mint", "Disable freeze when done"],
      chaosVariants: [{ trigger: "authorize.*--disable", condition: "authority already revoked", errorOutput: "Error: authority already disabled", hint: "Skip duplicate revoke" }],
      successMessage: "Authorities updated.",
    },
    {
      id: "token-7",
      title: "Create NFT (Supply 1)",
      difficulty: "hard",
      description: "Create a zero-decimal token and mint exactly one unit.",
      xpReward: 200,
      objectives: [
        { id: "t7-o1", text: "Run spl-token create-token --decimals 0", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+create-token\\s+--decimals\\s+0$" }, completed: false },
        { id: "t7-o2", text: "Run spl-token mint <mint> 1", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+mint\\s+[1-9A-HJ-NP-Za-km-z]{20,}\\s+1$" }, completed: false },
        { id: "t7-o3", text: "Disable mint authority", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+authorize\\s+[1-9A-HJ-NP-Za-km-z]{20,}\\s+mint\\s+--disable$" }, completed: false },
      ],
      hints: ["NFT-like token uses 0 decimals", "Mint only 1", "Then revoke mint authority"],
      successMessage: "NFT pattern complete.",
    },
    {
      id: "token-8",
      title: "Token Account Cleanup",
      difficulty: "hard",
      description: "Close unused token accounts and reclaim rent.",
      xpReward: 150,
      objectives: [
        { id: "t8-o1", text: "Run spl-token close <account>", type: "command", validation: { type: "command_match", pattern: "^spl-token\\s+close\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Close empty accounts to reclaim SOL", "Ensure account has zero balance first", "Use account address from prior outputs"],
      successMessage: "Cleanup complete.",
    },
  ],
};

const opsTrack: Quest = {
  id: "ops-track",
  track: "ops",
  title: "DevOps & Monitoring",
  description: "Operate deployed Solana programs safely and reliably.",
  missions: [
    {
      id: "ops-1",
      title: "Stream Program Logs",
      difficulty: "easy",
      description: "Inspect logs to understand live runtime behavior.",
      xpReward: 80,
      objectives: [
        { id: "o1-o1", text: "Run solana logs", type: "command", validation: { type: "command_match", pattern: "^solana\\s+logs$" }, completed: false },
      ],
      hints: ["Logs show instruction traces", "Use logs after deploy", "Command is solana logs"],
      successMessage: "Logs inspected.",
    },
    {
      id: "ops-2",
      title: "Confirm Transaction Health",
      difficulty: "easy",
      description: "Validate that submitted transactions are confirmed.",
      xpReward: 100,
      objectives: [
        { id: "o2-o1", text: "Run solana confirm <signature>", type: "command", validation: { type: "command_match", pattern: "^solana\\s+confirm\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Use a recent signature from transfers", "Confirmed means final at current commitment", "Run solana confirm <sig>"],
      successMessage: "Transaction health verified.",
    },
    {
      id: "ops-3",
      title: "Validate Program Metadata",
      difficulty: "medium",
      description: "Check the deployed program owner and authority.",
      xpReward: 120,
      objectives: [
        { id: "o3-o1", text: "Run solana program show <programId>", type: "command", validation: { type: "command_match", pattern: "^solana\\s+program\\s+show\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Program show returns owner + authority", "Use deployed program id", "Keep authority secure"],
      successMessage: "Program metadata validated.",
    },
    {
      id: "ops-4",
      title: "Rollback Readiness",
      difficulty: "medium",
      description: "Take a snapshot checkpoint before risky changes.",
      xpReward: 130,
      objectives: [
        { id: "o4-o1", text: "Run git status", type: "command", validation: { type: "command_match", pattern: "^git\\s+status$" }, completed: false },
        { id: "o4-o2", text: "Run git log", type: "command", validation: { type: "command_match", pattern: "^git\\s+log$" }, completed: false },
      ],
      hints: ["Always inspect state before updates", "Log confirms rollback points", "Use git status then git log"],
      successMessage: "Rollback posture established.",
    },
    {
      id: "ops-5",
      title: "Upgrade Checklist",
      difficulty: "hard",
      description: "Verify build, funds, and deployment conditions before upgrade.",
      xpReward: 180,
      objectives: [
        { id: "o5-o1", text: "Run anchor build", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+build$" }, completed: false },
        { id: "o5-o2", text: "Run solana balance", type: "state_check", validation: { type: "state_predicate", check: "balance > 2" }, completed: false },
        { id: "o5-o3", text: "Run anchor deploy", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+deploy$" }, completed: false },
      ],
      hints: ["Never deploy without a fresh build", "Ensure deploy wallet funded", "Then run anchor deploy"],
      successMessage: "Upgrade checklist complete.",
    },
    {
      id: "ops-6",
      title: "Ops Incident Drill",
      difficulty: "hard",
      description: "Diagnose and recover from simulated deployment failure.",
      xpReward: 200,
      objectives: [
        { id: "o6-o1", text: "Run anchor deploy", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+deploy$" }, completed: false },
        { id: "o6-o2", text: "Run solana logs", type: "command", validation: { type: "command_match", pattern: "^solana\\s+logs$" }, completed: false },
        { id: "o6-o3", text: "Run anchor verify <programId>", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+verify\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Read logs to pinpoint failure", "Redeploy if needed", "Verify once healthy"],
      successMessage: "Incident drill passed.",
    },
  ],
};

const securityTrack: Quest = {
  id: "security-track",
  track: "security",
  title: "Security Patterns",
  description: "Practice secure Solana development patterns in code and CLI.",
  missions: [
    {
      id: "sec-1",
      title: "Missing Signer Check",
      difficulty: "medium",
      description: "Ensure signer constraints are present in account validation.",
      xpReward: 120,
      objectives: [
        { id: "s1-o1", text: "Edit lib.rs to include signer validation", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "Signer|signer" }, completed: false },
        { id: "s1-o2", text: "Run anchor build", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+build$" }, completed: false },
      ],
      hints: ["Use Signer in Accounts struct", "Compile to validate fix", "Search for missing authority checks"],
      successMessage: "Signer check added.",
    },
    {
      id: "sec-2",
      title: "Wrong Owner Validation",
      difficulty: "medium",
      description: "Prevent account substitution by validating ownership.",
      xpReward: 130,
      objectives: [
        { id: "s2-o1", text: "Edit account constraints for owner checks", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "owner" }, completed: false },
        { id: "s2-o2", text: "Run anchor test", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+test$" }, completed: false },
      ],
      hints: ["Verify account owner program", "Tests should catch spoofed accounts", "Use constraint attributes"],
      successMessage: "Owner validation fixed.",
    },
    {
      id: "sec-3",
      title: "Integer Overflow Guard",
      difficulty: "medium",
      description: "Add checked arithmetic for balance/amount updates.",
      xpReward: 140,
      objectives: [
        { id: "s3-o1", text: "Edit code to use checked_add or checked_sub", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "checked_add|checked_sub" }, completed: false },
        { id: "s3-o2", text: "Run anchor build", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+build$" }, completed: false },
      ],
      hints: ["Never trust unchecked arithmetic", "Use Rust checked_* methods", "Propagate custom error on overflow"],
      successMessage: "Overflow protections added.",
    },
    {
      id: "sec-4",
      title: "Authority Mistake",
      difficulty: "hard",
      description: "Fix authority logic to prevent privilege escalation.",
      xpReward: 170,
      objectives: [
        { id: "s4-o1", text: "Edit authority checks", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "has_one|authority" }, completed: false },
        { id: "s4-o2", text: "Run anchor test", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+test$" }, completed: false },
      ],
      hints: ["Use has_one constraints", "Ensure signer matches authority key", "Tests should validate unauthorized paths"],
      successMessage: "Authority checks hardened.",
    },
    {
      id: "sec-5",
      title: "Replay Protection",
      difficulty: "hard",
      description: "Add nonce/sequence validation for repeated instruction calls.",
      xpReward: 180,
      objectives: [
        { id: "s5-o1", text: "Edit code to include nonce/sequence checks", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "nonce|sequence" }, completed: false },
        { id: "s5-o2", text: "Run anchor build", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+build$" }, completed: false },
      ],
      hints: ["Prevent duplicated signed payload usage", "Store and increment nonce", "Reject stale inputs"],
      successMessage: "Replay protections applied.",
    },
    {
      id: "sec-6",
      title: "Secure Release Verification",
      difficulty: "hard",
      description: "Verify secure build and deployment state before release.",
      xpReward: 220,
      objectives: [
        { id: "s6-o1", text: "Run anchor deploy", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+deploy$" }, completed: false },
        { id: "s6-o2", text: "Run anchor verify <programId>", type: "command", validation: { type: "command_match", pattern: "^anchor\\s+verify\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
        { id: "s6-o3", text: "Run solana program show <programId>", type: "command", validation: { type: "command_match", pattern: "^solana\\s+program\\s+show\\s+[1-9A-HJ-NP-Za-km-z]{20,}$" }, completed: false },
      ],
      hints: ["Deploy only after secure code passes", "Verify deterministic binary", "Confirm owner/authority in program show"],
      successMessage: "Security track complete.",
    },
  ],
};

const pdaTrack: Quest = {
  id: "pda-track",
  track: "pda",
  title: "PDA Mastery",
  description: "Master Program Derived Addresses for deterministic state management.",
  missions: [
    {
      id: "pda-1",
      title: "What are PDAs?",
      difficulty: "easy",
      description: "Understand Program Derived Addresses and why they have no private key.",
      xpReward: 80,
      objectives: [
        { id: "pda1-o1", text: "Read PDA explanation: Run cat ~/pda-basics.md", type: "command", validation: { type: "command_match", pattern: "^cat\s+~/pda-basics\\.md$" }, completed: false },
        { id: "pda1-o2", text: "Run solana address to see a normal keypair address", type: "command", validation: { type: "command_match", pattern: "^solana\s+address$" }, completed: false },
      ],
      hints: ["PDAs are off-curve (no private key)", "Derived from seeds + program ID", "Programs can sign for PDAs"],
      requiredFiles: {
        "pda-basics.md": "# Program Derived Addresses (PDAs)\n\n## What are PDAs?\n- Deterministic addresses derived from seeds\n- Off-curve (not a valid Ed25519 point)\n- No private key exists\n\n## Why Use PDAs?\n- Deterministic: same seeds = same address\n- Program can sign via invoke_signed\n- Store state per user/entity\n\n## Key Properties\n- Bump seed ensures off-curve\n- Seeds can be: strings, pubkeys, numbers\n- Only the deriving program can sign\n",
      },
      successMessage: "PDA concept understood!",
    },
    {
      id: "pda-2",
      title: "Finding PDAs",
      difficulty: "easy",
      description: "Use find_program_address to derive PDAs from seeds.",
      xpReward: 100,
      objectives: [
        { id: "pda2-o1", text: "View PDA derivation example: Run cat ~/pda-derive.rs", type: "command", validation: { type: "command_match", pattern: "^cat\s+~/pda-derive\\.rs$" }, completed: false },
        { id: "pda2-o2", text: "Open programs/my_program/src/lib.rs to find PDA usage", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "find_program_address|seeds" }, completed: false },
      ],
      hints: ["find_program_address returns (pubkey, bump)", "Seeds are byte arrays", "Same seeds always give same PDA"],
      requiredFiles: {
        "pda-derive.rs": "// PDA Derivation Example\nuse anchor_lang::prelude::*;\n\n// Find a PDA for user state\nlet (pda, bump) = Pubkey::find_program_address(\n    &[\n        b\"user_state\",\n        user.key().as_ref(),\n    ],\n    program_id,\n);\n\n// pda is the derived address\n// bump is the seed making it off-curve\n",
      },
      successMessage: "PDA derivation understood!",
    },
    {
      id: "pda-3",
      title: "PDA as Signer",
      difficulty: "medium",
      description: "Learn how programs sign for PDAs using invoke_signed.",
      xpReward: 140,
      objectives: [
        { id: "pda3-o1", text: "View invoke_signed example: Run cat ~/invoke-signed.rs", type: "command", validation: { type: "command_match", pattern: "^cat\s+~/invoke-signed\\.rs$" }, completed: false },
        { id: "pda3-o2", text: "Find invoke_signed in lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "invoke_signed|signer_seeds" }, completed: false },
        { id: "pda3-o3", text: "Run anchor build to verify signer logic", type: "command", validation: { type: "command_match", pattern: "^anchor\s+build$" }, completed: false },
      ],
      hints: ["invoke_signed lets program sign for PDA", "Must pass same seeds used to derive", "Runtime verifies derivation proof"],
      requiredFiles: {
        "invoke-signed.rs": "// PDA Signing Example\nlet seeds = &[\n    b\"token_vault\",\n    mint.key().as_ref(),\n    &[bump],\n];\n\nlet signer_seeds = &[&seeds[..]];\n\n// Transfer from PDA-owned account\ntoken::transfer(\n    CpiContext::new_with_signer(\n        token_program.to_account_info(),\n        Transfer {\n            from: vault.to_account_info(),\n            to: recipient.to_account_info(),\n            authority: vault_authority.to_account_info(),\n        },\n        signer_seeds,\n    ),\n    amount,\n)?;\n",
      },
      successMessage: "PDA signing mastered!",
    },
    {
      id: "pda-4",
      title: "PDA Best Practices",
      difficulty: "medium",
      description: "Security considerations and patterns for PDA usage.",
      xpReward: 130,
      objectives: [
        { id: "pda4-o1", text: "Read PDA security guide: Run cat ~/pda-security.md", type: "command", validation: { type: "command_match", pattern: "^cat\s+~/pda-security\\.md$" }, completed: false },
        { id: "pda4-o2", text: "Verify seed validation in lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "seeds\\s*=|seed\\s*=" }, completed: false },
      ],
      hints: ["Always verify PDA derivation on-chain", "Include unique identifiers in seeds", "Document seed structure clearly"],
      requiredFiles: {
        "pda-security.md": "# PDA Security Best Practices\n\n## Seed Validation\n- Always re-derive PDA in program\n- Verify address matches expected\n- Include unique identifiers (user pubkey)\n\n## Common Patterns\n- user_state: [\"user\", user_pubkey]\n- token_account: [\"token\", mint, user]\n- vault: [\"vault\", mint, program_id]\n\n## Anti-Patterns\n- Using predictable seeds only\n- Not bumping when collision\n- Passing PDA without verification\n\n## Security\n- Anyone can derive PDAs client-side\n- Only program can verify and sign\n- Document your seed schema\n",
      },
      successMessage: "PDA security understood!",
    },
    {
      id: "pda-5",
      title: "Build a Counter with PDA",
      difficulty: "hard",
      description: "Create a counter program that stores state in a PDA per user.",
      xpReward: 200,
      objectives: [
        { id: "pda5-o1", text: "Add Counter state struct to lib.rs", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "struct\\s+Counter|pub\s+count:" }, completed: false },
        { id: "pda5-o2", text: "Add initialize instruction with PDA", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "pub\s+fn\s+initialize" }, completed: false },
        { id: "pda5-o3", text: "Add increment instruction", type: "edit", validation: { type: "file_contains", path: "my-solana-project/programs/my_program/src/lib.rs", pattern: "pub\s+fn\s+increment" }, completed: false },
        { id: "pda5-o4", text: "Run anchor build", type: "command", validation: { type: "command_match", pattern: "^anchor\s+build$" }, completed: false },
        { id: "pda5-o5", text: "Run anchor test", type: "command", validation: { type: "command_match", pattern: "^anchor\s+test$" }, completed: false },
      ],
      hints: ["Store counter in account data", "Derive PDA from user pubkey", "Initialize if needed, increment if exists", "Test with multiple users"],
      successMessage: "PDA counter complete!",
    },
  ],
};

export const devlabQuests: Quest[] = [foundationTrack, builderTrack, tokenTrack, opsTrack, securityTrack, pdaTrack];

export function getQuestByTrack(track: Quest["track"]): Quest {
  const quest = devlabQuests.find((item) => item.track === track);
  if (!quest) {
    return builderTrack;
  }
  return quest;
}
